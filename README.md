# Buzzvel Virtual Card Test

This repository contains the source code of a test from Buzzvel.  
Below are the instructions to get the API and the WebApp up and running.

## The backend

The backend consists in a Laravel API. In order to run it, enter the backend folder and run the following command:

```
docker-compose up
```

After that, you'll need a database named `buzzvel`.  
You can connect to the database using the following credentials:

```
host: localhost
port: 3080
username: root
password: root
```

After creating your `buzzvel` database, you can enter in the docker container and run the database migrations and seeders:

```
docker container exec -it buzzvel bash
php artisan migrate:fresh --seed
```

Congratulations, now you have an API up and running!

### API Routes

The API has 3 routes. Click in each route below to show more details.

<details>
    <summary>
        <code>GET</code>
        <code><b>/api/links</b></code>
        <code>List available links to be filled by clients.</code>
    </summary>

##### Responses
> | http code | content-type       | response                                        |
> | --------- | ------------------ | ----------------------------------------------- |
> | `200`     | `application/json` | array of items [{"id": number,"label": string}] |

</details>

<details>
    <summary>
        <code>GET</code>
        <code><b>/api/pages/{pageName}</b></code>
        <code>Show a page created by a client.</code>
    </summary>

##### Parameters
> | name       | optional | data type | description                                               |
> | ---------- | -------- | --------- | --------------------------------------------------------- |
> | `pageName` | no       | string    | The page name choosen by the client in the creation form. |

##### Responses
> | http code | content-type       | response              |
> | --------- | ------------------ | --------------------- |
> | `200`     | `application/json` | Page info (see below) |
> | `404`     | `text/plain`       | Not found             |

Page info response example:

```
{
   "name":"test",
   "links":[
      {
         "id":2,
         "label":"Github",
         "pivot":{
            "page_id":12,
            "link_id":2,
            "url_address":"github.com"
         }
      },
      {
         "id":1,
         "label":"LinkedIn",
         "pivot":{
            "page_id":12,
            "link_id":1,
            "url_address":"http:\/\/linkedin.com"
         }
      }
   ]
}
```

</details>

<details>
    <summary>
        <code>POST</code>
        <code><b>/api/pages</b></code>
        <code>Creates a new page.</code>
    </summary>

##### Parameters
> | name    | optional                 | data type        | description                                            |
> | ------- | ------------------------ | ---------------- | ------------------------------------------------------ |
> | `name`  | no                       | string           | The page name that will represent the URL path.        |
> | `links` | no (at least 1 required) | array of objects | The links to be shown at the page (see example below). |

Example of POST:

```
{
   "name":"john",
   "links":[
      {
         "link_id":2,
         "url_address":"github.com/test"
      },
      {
         "link_id":1,
         "url_address":"linkedin.com/test"
      }
   ]
}
```

##### Responses
> | http code | content-type       | response                                                       |
> | --------- | ------------------ | -------------------------------------------------------------- |
> | `200`     | `application/json` | {name: string}                                                 |
> | `422`     | `application/json` | Object containing one or more field errors (see example below) |

Example response for status 422:

```
{
   "name":[
      "The name has already been taken."
   ]
}
```

</details>

### API Database Schema

The API contain 3 main database tables.

The `pages` table store each page generated by the clients:

```
id: bigint(20) unsigned
name: varchar(255)
created_at: timestamp
updated_at: timestamp
```

The `links` table store the available links to clients fill in:

```
id: bigint(20) unsigned
label: varchar(255)
```

Finally, the `link_page` is a pivot table that stores the relation between link and page, alongside the URL address for each link.

```
page_id: bigint(20) unsigned
link_id: bigint(20) unsigned
url_address: varchar(2048)
```

## The frontend

The frontend is a SPA built with React using Vite and Typescript.

### Usage
To run this SPA you can use a pre generated docker image or generate your own.

If you want to use an existing image, you can run it using the following command:
```
docker run -d -p 3000:80 arturcs/buzzvel-test-spa
```
After that, you can access the SPA in your browser by typing http://localhost:3000

----

If you want to build your own image, enter the `frontend` folder and run the following commands:
```
docker image build -t {YOUR_IMAGE_NAME} .
docker run -d -p 3000:80 {YOUR_IMAGE_NAME}
```
After that, you can access the SPA in your browser by typing http://localhost:3000

### SPA Routes
The path `/` or `/generate` will load a page with a form to generate new pages.  
The dynamic route `/:pageName` will load a page using the API and display the links related to that page.